(function(a){"use strict";function b(a,b,c){var d=document.createElement("a");d.setAttribute("href",a),d.setAttribute("download",c||"graph."+b);var e=document.createEvent("MouseEvent");e.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),d.dispatchEvent(e),d.remove()}function c(a,b,c){var d=Math.min(c/a,c/b);return{width:a*d,height:b*d}}function d(a,b,c){var d;return d=sigma.utils.getBoundaries(a.graph,b.camera.readPrefix),d.minX/=c.zoomRatio,d.minY/=c.zoomRatio,d.maxX/=c.zoomRatio,d.maxY/=c.zoomRatio,d}function e(a,b,e){var f,g=e.margin||0,h={width:b.width,height:b.height};return e.clips||e.size?e.size&&e.size>=1&&(h=c(b.width,b.height,e.size)):(f=d(a,b,e),h={width:f.maxX-f.minX+2*f.sizeMax,height:f.maxY-f.minY+2*f.sizeMax}),h.width+=g,h.height+=g,h}function f(a,c,d){if(d=d||{},d.format&&!(d.format in h))throw Error('sigma.renderers.image: unsupported format "'+d.format+'".');var f=e(a,c,d);d.clip||this.clone(a,d,f);var g=this.draw(c,d,f),i=g.toDataURL(h[d.format||"png"]);return d.download&&b(i,d.format||"png",d.filename),i}if("undefined"==typeof sigma)throw"sigma is not declared";sigma.utils.pkg("sigma.plugins");var g,h,i,j;g=["scene","edges","nodes","labels"],h={png:"image/png",jpg:"image/jpeg",gif:"image/gif",tiff:"image/tiff"},f.prototype.clone=function(a,b,c){b.tmpContainer=b.tmpContainer||"image-container";var d=document.getElementById(b.tmpContainer);d||(d=document.createElement("div"),d.id=b.tmpContainer,document.body.appendChild(d)),d.setAttribute("style","width:"+c.width+"px;height:"+Math.round(c.height)+"px;");var e=a.addRenderer({container:document.getElementById(b.tmpContainer),type:"canvas",settings:{batchEdgesDrawing:!0,drawLabels:!!b.labels}});e.camera.ratio=b.zoomRatio>0?b.zoomRatio:1;var f=e instanceof sigma.renderers.webgl,h=!1,k=[];i=document.createElement("canvas"),j=i.getContext("2d"),a.refresh(),g.forEach(function(a){if(e.contexts[a]&&(b.labels!==!1||"labels"!==a)){var d=e.domElements[a]||e.domElements.scene,g=e.contexts[a];h||(i.width=c.width,i.height=c.height,f&&g instanceof WebGLRenderingContext&&(i.width*=.5,i.height*=.5),h=!0),g instanceof WebGLRenderingContext?j.drawImage(d,0,0,d.width/2,d.height/2):j.drawImage(d,0,0),~k.indexOf(g)||k.push(g)}}),k=[],a.killRenderer(e),d.remove()},f.prototype.draw=function(a,b,d){(!b.size||b.size<1)&&(b.size=window.innerWidth);var e=a instanceof sigma.renderers.webgl,f=!1,h=[],j=document.createElement("canvas"),k=j.getContext("2d");return g.forEach(function(g){if(a.contexts[g]&&(b.labels!==!1||"labels"!==g)){var l=a.domElements[g]||a.domElements.scene,m=a.contexts[g];if(!~h.indexOf(m)){if(!f){var n,o;b.clip?(n=l.width,o=l.height,d=c(n,o,b.size)):(n=i.width,o=i.height),j.width=d.width,j.height=d.height,!e&&!m instanceof WebGLRenderingContext&&(j.width*=2,j.height*=2),f=!0,b.background&&(k.rect(0,0,j.width,j.height),k.fillStyle=b.background,k.fill())}b.clip?k.drawImage(l,0,0,j.width,j.height):k.drawImage(i,0,0,j.width,j.height),h.push(m)}}}),h=[],j};var k=null;sigma.plugins.image=function(a,b,c){return sigma.plugins.killImage(),k||(k=new f(a,b,c)),k},sigma.plugins.killImage=function(){k instanceof f&&(k=null,i=null,j=null)}}).call(this);
//# sourceMappingURL=sigma.plugins.image.min.js.map