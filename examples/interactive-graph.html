<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <script src="../js/linkurious-v1.0.7/sigma.min.js"></script>

    <script src="../js/linkurious-v1.0.7/plugins/sigma.plugins.dragNodes.min.js"></script>
    <script src="../js/linkurious-v1.0.7/plugins/sigma.helpers.graph.min.js"></script>
    <script src="../js/linkurious-v1.0.7/plugins/sigma.plugins.keyboard.min.js"></script>
    <script src="../js/linkurious-v1.0.7/plugins/sigma.plugins.activeState.min.js"></script>
    <script src="../js/linkurious-v1.0.7/plugins/sigma.plugins.select.min.js"></script>
    <script src="../js/linkurious-v1.0.7/plugins/sigma.plugins.tooltips.min.js"></script>
    <script src="../js/linkurious-v1.0.7/plugins/sigma.plugins.lasso.min.js"></script>
</head>
<body>
<div id="container">
    <style>
        #graph-container {
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            position: absolute;
        }

        .sigma-tooltip {
            max-width: 240px;
            max-height: 280px;
            background-color: rgb(249, 247, 237);
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            border-radius: 6px;
        }
        .sigma-tooltip-header {
            font-variant: small-caps;
            font-size: 120%;
            color: #437356;
            border-bottom: 1px solid #aac789;
            padding: 10px;
        }
        .sigma-tooltip-body {
            padding: 10px;
        }
        .sigma-tooltip-body th {
            color: #999;
            text-align: left;
        }
        .sigma-tooltip-footer {
            padding: 10px;
            border-top: 1px solid #aac789;
        }
        .sigma-tooltip > .arrow {
            border-width: 10px;
            position: absolute;
            display: block;
            width: 0;
            height: 0;
            border-color: transparent;
            border-style: solid;
        }
        .sigma-tooltip.top {
            margin-top: -12px;
        }
        .sigma-tooltip.top > .arrow {
            left: 50%;
            bottom: -10px;
            margin-left: -10px;
            border-top-color: rgb(249, 247, 237);
            border-bottom-width: 0;
        }
        .sigma-tooltip.bottom {
            margin-top: 12px;
        }
        .sigma-tooltip.bottom > .arrow {
            left: 50%;
            top: -10px;
            margin-left: -10px;
            border-bottom-color: rgb(249, 247, 237);
            border-top-width: 0;
        }
        .sigma-tooltip.left {
            margin-left: -12px;
        }
        .sigma-tooltip.left > .arrow {
            top: 50%;
            right: -10px;
            margin-top: -10px;
            border-left-color: rgb(249, 247, 237);
            border-right-width: 0;
        }
        .sigma-tooltip.right {
            margin-left: 12px;
        }
        .sigma-tooltip.right > .arrow {
            top: 50%;
            left: -10px;
            margin-top: -10px;
            border-right-color: rgb(249, 247, 237);
            border-left-width: 0;
        }
    </style>
    <div id="graph-container"></div>
</div>
<script>

    function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                results = regex.exec(location.search);
        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }

    var
            queryClusters = getParameterByName('clusters'),
            queryNodeByCluster = getParameterByName('nodeByCluster'),
            queryEdges = getParameterByName('edgesInterCluster'),
            queryClusterRatio = getParameterByName('clusterRatio');

    var i,
            clusterCenterArray = [],
            nodeColor = '#cd476a',
            clusterCenters = (queryClusters !== '') ? parseInt(queryClusters, 10) : 20,
            clusterSize = (queryClusterRatio !== '') ? parseFloat(queryClusterRatio) : 0.05,
            N = (queryNodeByCluster !== '') ? parseInt(queryNodeByCluster, 10) : 20,
            E = (queryEdges !== '') ? parseInt(queryEdges, 10) : 20,
            g = {
                nodes: [],
                edges: []
            };
    // Generate a random graph:
    for (i = 0; i < N * clusterCenters; i = i + N) {
        g.nodes.push({
            id: 'n' + i,
            x: Math.random() * window.innerWidth,
            y: Math.random() * window.innerHeight,
            size: 1,
            color: nodeColor
        });

        clusterCenterArray.push(g.nodes[i]);

        for (var j =  i + 1 ; j < i + N ; j++){
            g.nodes.push({
                id: 'n' + j,
                x: (Math.floor(Math.random() * 2) == 1 ? 1 : -1) * Math.random() * clusterSize * window.innerWidth  + g.nodes[i].x,
                y: (Math.floor(Math.random() * 2) == 1 ? 1 : -1) * Math.random() * clusterSize * window.innerHeight + g.nodes[i].y,
                size: 1,
                color: nodeColor
            });

            g.edges.push({
                id: 'e' + (j - 1),
                source: 'n' + i,
                target: 'n' + j,
                size: 1,
                color: '#ccc'
            });
        }
    }

    var
        sourceIndex = 0,
        targetIndex = 0,
        lastIndex = g.edges.length + clusterCenters + E ;

    for (i = g.edges.length + clusterCenters + 1 ; i < lastIndex; i++){
        sourceIndex = Math.floor(Math.random() * clusterCenterArray.length);
        targetIndex = Math.floor(Math.random() * clusterCenterArray.length);

        g.edges.push({
            id: 'e' + i,
            source: clusterCenterArray[sourceIndex].id,
            target: clusterCenterArray[targetIndex].id,
            size: Math.random(),
            color: '#ccc'
        });
    }

    // Instantiate sigma:
    var s = new sigma({
        graph: g,
        renderer: {
            container: document.getElementById('graph-container'),
            type: 'canvas'
        },
        settings: {
            maxNodeSize: 5,
            borderSize: 2,
            outerBorderSize: 3,
            defaultNodeBorderColor: '#fff',
            defaultNodeOuterBorderColor: 'rgb(236, 81, 72)',
            enableEdgeHovering: true,
            edgeHoverHighlightNodes: 'circle'
        }
    });


    // Instanciate the ActiveState plugin:
    var activeState = sigma.plugins.activeState(s);
    var keyboard = sigma.plugins.keyboard(s, s.renderers[0]);
    // Initialize the Select plugin:
    var select = sigma.plugins.select(s, activeState);
    select.bindKeyboard(keyboard);
    // Initialize the dragNodes plugin:
    var dragListener = sigma.plugins.dragNodes(s, s.renderers[0], activeState);

    var config = {
        node: {
            show: 'overNode',
            hide: 'outNode',
            cssClass: 'sigma-tooltip',
            position: 'top',
            renderer: function(node) {

                return '<div class="arrow"></div>' +
                ' <div class="sigma-tooltip-header">Node</div>' +
                '  <div class="sigma-tooltip-body">' +
                '  </div>' +
                '  <div class="sigma-tooltip-footer">Number of connections: '+ this.degree(node.id) +'</div>'
            }
        }
    };
    // Instanciate the tooltips plugin with a Mustache renderer for node tooltips:
    var tooltips = sigma.plugins.tooltips(s, s.renderers[0], config);
    // Manually open a tooltip on a node:
    var n = s.graph.nodes('n10');
    var prefix = s.renderers[0].camera.prefix;
    tooltips.open(n, config.node, n[prefix + 'x'], n[prefix + 'y']);

    var lasso = new sigma.plugins.lasso(s, s.renderers[0], {
        'strokeStyle': 'black',
        'lineWidth': 2,
        'fillWhileDrawing': true,
        'fillStyle': 'rgba(41, 41, 41, 0.2)',
        'cursor': 'crosshair'
    });
    // Listen for selectedNodes event
    lasso.bind('selectedNodes', function (event) {
        // Do something with the selected nodes
        var nodes = event.data;
        console.log('nodes', nodes);
        // For instance, reset all node size as their initial size
        s.graph.nodes().forEach(function (node) {
            node.color = nodeColor;
            node.size = 50;
        });
        // Then increase the size of selected nodes...
        nodes.forEach(function (node) {
            node.color = '#f35371';
            node.size *= 3;
        });
        s.refresh();
    });

    // Alt + L
    document.addEventListener('keyup', function (event) {
        if (event.keyCode === 76) {
            if (lasso.isActive) {
                lasso.deactivate();
            } else {
                lasso.activate();
            }
        }
    });

</script>
</body>
</html>
